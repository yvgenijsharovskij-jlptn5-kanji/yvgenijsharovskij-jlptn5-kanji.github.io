function init(){sceneCSS=new THREE.Scene,sceneGL=new THREE.Scene,orbitCamera=new THREE.PerspectiveCamera(fov,window.innerWidth/window.innerHeight,near,far),orbitCamera.position.z=3e3,setN5KanjiTable(),rendererGL=Detector.webgl?new THREE.WebGLRenderer({alpha:!0,antialiasing:!0}):new THREE.CanvasRenderer,rendererGL.setClearColor(0,0),rendererGL.setPixelRatio(window.devicePixelRatio),rendererGL.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(rendererGL.domElement),rendererCSS=new THREE.CSS3DRenderer,rendererCSS.setSize(window.innerWidth,window.innerHeight),rendererCSS.domElement.style.position="absolute",rendererCSS.domElement.style.top=0,document.getElementById("container").appendChild(rendererCSS.domElement),orbitControls=new THREE.OrbitControls(orbitCamera),orbitControls.rotateSpeed=.5,orbitControls.minDistance=500,orbitControls.maxDistance=5e3,orbitControls.addEventListener("change",render),effect=new THREE.VREffect(rendererGL),effect.setSize(window.innerWidth,window.innerHeight);for(var a=0;a<objects.length;a++)tweenTranslate(objects[a],targets.N5KanjiTable[a],20,Math.random()*duration*2);new TWEEN.Tween(this).to({},2*duration).onUpdate(render).start(),window.addEventListener("resize",onResize,!1),window.addEventListener("mousemove",onDocumentMouseMove,!1)}function setN5KanjiTable(){for(var a=0;a<N5KanjiTable.length;a+=6){var b=document.createElement("div");b.className="kanji-box";var c=document.createElement("div");c.className="kanji",c.textContent=N5KanjiTable[a+1],b.appendChild(c);var d=document.createElement("div");d.className="hatsuon",d.innerHTML=N5KanjiTable[a+2]+"<br>"+N5KanjiTable[a+3],b.appendChild(d);var e=new THREE.CSS3DObject(b);e.position.x=N5KanjiTable[a+4]*gridPadding-1630,e.position.y=-(N5KanjiTable[a+5]*gridPadding)+990,e.position.z=4e3*Math.random()-2e3,sceneCSS.add(e),objects.push(e);var e=new THREE.Object3D;e.position.x=N5KanjiTable[a+4]*gridPadding-1630,e.position.y=-(N5KanjiTable[a+5]*gridPadding)+990,targets.N5KanjiTable.push(e),cube=new THREE.Mesh(new THREE.CubeGeometry(160,180,40),new THREE.MeshBasicMaterial({color:10066431})),cube.position.x=N5KanjiTable[a+4]*gridPadding-1630,cube.position.y=-(N5KanjiTable[a+5]*gridPadding)+990,sceneGL.add(cube)}}function onDocumentMouseMove(a){a.preventDefault(),mouse.x=a.clientX/window.innerWidth*2-1,mouse.y=2*-(a.clientY/window.innerHeight)+1,mouseHandler()}function mouseHandler(){var a=new THREE.Raycaster;a.setFromCamera(mouse,orbitCamera);var b=a.intersectObjects(sceneGL.children);b.length>0?(b[0].object!=intersectionObject&&(intersectionObject&&(intersectionObject.material.color.setHex(intersectionObject.currentHex),(intersectionObject.position.z=60)&&tweenTranslate(intersectionObject,intersectionObject,-60,222)),intersectionObject=b[0].object,intersectionObject.currentHex=intersectionObject.material.color.getHex(),intersectionObject.material.color.setHex(13395558),tweenTranslate(intersectionObject,intersectionObject,60,duration/222)),render()):(intersectionObject.material.color.setHex(10066431),TWEEN.stop,TWEEN.removeAll,(intersectionObject.position.z=60)&&tweenTranslate(intersectionObject,intersectionObject,-60,222),intersectionObject=null,render())}function tweenTranslate(a,b,c,d){new TWEEN.Tween(a.position).to({x:b.position.x,y:b.position.y,z:b.position.z+c},d).easing(TWEEN.Easing.Quartic.InOut).start()}function onResize(){orbitCamera.aspect=window.innerWidth/window.innerHeight,orbitCamera.updateProjectionMatrix(),rendererCSS.setSize(window.innerWidth,window.innerHeight),effect.setSize(window.innerWidth,window.innerHeight),render()}function animate(){requestAnimationFrame(animate),TWEEN.update(),orbitControls.update(),mouseHandler()}function render(){rendererCSS.render(sceneCSS,orbitCamera),effect.render(sceneGL,orbitCamera)}var vrCamera,orbitCamera,sceneCSS,sceneGL,rendererCSS,rendererGL,effect,vrDisplay,orbitControls,objects=[],targets={N5KanjiTable:[]},cube,gridPadding=220,duration=2e3,fov=40,near=1,far=1e4,mouse=new THREE.Vector2,intersectionObject;init(),animate();